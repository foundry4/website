<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Choosing your cake and eating it</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Choosing your cake and eating it</h1>
</header>
<section data-field="subtitle" class="p-summary">
The bottom line of microservice language choice
</section>
<section data-field="body" class="e-content">
<section name="14cd" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="52b0" id="52b0" class="graf graf--h3 graf--leading graf--title">Choosing your cake and eating it</h3><h4 name="4aa7" id="4aa7" class="graf graf--h4 graf-after--h3 graf--subtitle">The bottom line of microservice language choice</h4><blockquote name="9492" id="9492" class="graf graf--blockquote graf-after--h4">TL;DR When it comes to technology choice, safe-bet right answers of the <a href="https://medium.com/@davidcarboni/demystifying-cloud-its-procurement-and-agile-93b67f593e33" data-href="https://medium.com/@davidcarboni/demystifying-cloud-its-procurement-and-agile-93b67f593e33" class="markup--anchor markup--blockquote-anchor" target="_blank">datacentre era</a> can be two orders of magnitude wrong for containerised microservices — in cash.</blockquote><p name="a3ff" id="a3ff" class="graf graf--p graf-after--blockquote">Let’s talk cake. I like to visualise, and I like cake. So, my favourite permanent markers in hand, here’s your guide to a lighter, fluffier microservice cloud life.</p><figure name="19fa" id="19fa" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 496px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 70.89999999999999%;"></div><img class="graf-image" data-image-id="1*Baq4G2EW3beTEF5CbINXBQ.jpeg" data-width="3492" data-height="2476" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/1*Baq4G2EW3beTEF5CbINXBQ.jpeg"></div></figure><p name="b8a8" id="b8a8" class="graf graf--p graf-after--figure">Microservices are a big deal right now. So are containers. I’m going to ask what’s in those containers. If you organisation defaults to using the Java Virtual Machine (JVM) I’d like to give you a different way of looking at that choice.</p><p name="8578" id="8578" class="graf graf--p graf-after--p">I’d like to convince you that “right” choices, ones that helped you in a datacentre-and-monolith world, will harm you in the cloud-and-microservices world. I’ll start with design and end with money.</p><blockquote name="d5f2" id="d5f2" class="graf graf--pullquote graf-after--p">Taking answers that work in one context and using them in a context with fundamentally different dynamics is risky at best</blockquote><p name="00f1" id="00f1" class="graf graf--p graf-after--pullquote">Let’s examine the assumptions and ask whether it’s time to choose different tools for a different job in a different world.</p><h4 name="be17" id="be17" class="graf graf--h4 graf-after--p">Cake-as-a-Metaphor</h4><p name="19ef" id="19ef" class="graf graf--p graf-after--h4">To look at what’s going on from a new perspective, let’s start by creating a mental image of what technology looks like in practice. A lot has changed over 20 years, but this way of looking at tech works pretty well across that time.</p><p name="ed9f" id="ed9f" class="graf graf--p graf-after--p">We’ll use this metaphor to visualise what happens when we lift-and-shift the JVM into containers and start using it to run microservices:</p><figure name="fc50" id="fc50" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 494px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 70.5%;"></div><img class="graf-image" data-image-id="1*F-rMikE3aRsAgmHsrssriQ.jpeg" data-width="3324" data-height="2344" src="https://cdn-images-1.medium.com/max/800/1*F-rMikE3aRsAgmHsrssriQ.jpeg"></div></figure><p name="2841" id="2841" class="graf graf--p graf-after--figure">Let’s unpack a little. Getting value from technology takes three roles:</p><ul class="postList"><li name="0784" id="0784" class="graf graf--li graf-after--p">Infrastructure: developer laptop, physical server, virtual machine, cloud compute, etc. This your cake plate — the foundation.</li><li name="b8a0" id="b8a0" class="graf graf--li graf-after--li">Platform: In the middle, there’s a platform. This provides much of the heavy lifting. Services that make the life of your app simpler, from writing it to deploying it, running it and supporting it. A key point here is a good platform allows you to move an app to different infrastructure: “<em class="markup--em markup--li-em">build once, run anywhere</em>”. This is your spongy cake — the big helpful middle.</li><li name="32e0" id="32e0" class="graf graf--li graf-after--li">Apps: on top of the cake sit your candles, the software you actually want to run (we’ll talk about microservices, but the same principles apply to say AWS Lambda Functions). <em class="markup--em markup--li-em">This is where the value happens</em>.</li></ul><p name="1230" id="1230" class="graf graf--p graf-after--li">Your infrastructure and platform are externalities — incidental complexity. They may be necessary, but don’t directly provide value. Time, effort and money your organisation spends there is, in the Lean sense, <em class="markup--em markup--p-em">waste</em>.</p><p name="f791" id="f791" class="graf graf--p graf-after--p">Success is getting those candles (apps) up there, lighting them and keeping those lights shining in a competitive world.</p><h4 name="bfa7" id="bfa7" class="graf graf--h4 graf-after--p">Same roles, new logos</h4><p name="0560" id="0560" class="graf graf--p graf-after--h4">Technology comes and goes. New ideas, new ways of working and, in particular, new ways of meeting the three roles of <em class="markup--em markup--p-em">infrastructure</em>, <em class="markup--em markup--p-em">platform</em> and <em class="markup--em markup--p-em">apps</em>.</p><p name="fee4" id="fee4" class="graf graf--p graf-after--p">Let’s take a look at how that shift has altered the technology landscape. Here’s how those roles looked around the turn of the century, and how they look now:</p><figure name="c5a3" id="c5a3" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 497px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 71%;"></div><img class="graf-image" data-image-id="1*hC_3N5Wu18t7o8Ts2lvsDQ.jpeg" data-width="3385" data-height="2405" src="https://cdn-images-1.medium.com/max/800/1*hC_3N5Wu18t7o8Ts2lvsDQ.jpeg"></div></figure><p name="4197" id="4197" class="graf graf--p graf-after--figure">The model has remained consistent, but every role has a new logo. Let’s look at what changed:</p><ul class="postList"><li name="afd1" id="afd1" class="graf graf--li graf-after--p">A capex infrastructure model (pre-provisioned physical servers and datacentres) has evolved into an opex one (on-demand cloud/utility billing). You probably used to buy Unix servers. You likely now consume that capability from AWS. <em class="markup--em markup--li-em">Now you only pay for what you use</em>.</li><li name="7b09" id="7b09" class="graf graf--li graf-after--li">The JVM fulfilled the platform role brilliantly in a capex world, rightly making it a datacentre darling. As opex became the norm, a new platform emerged, designed with an opex mindset: Docker. It fulfils the same role as the JVM, providing that crucial <em class="markup--em markup--li-em">build once, run anywhere</em> capability.</li><li name="79ee" id="79ee" class="graf graf--li graf-after--li">In the app role, the JVM allowed you to run packaged apps written in any compatible programming language. Docker now lets you run apps built in any language.</li></ul><p name="5fb6" id="5fb6" class="graf graf--p graf-after--li"><em class="markup--em markup--p-em">The key point here is that, for an opex world, Docker has taken on the role that the JVM fulfilled in the capex world.</em></p><h4 name="acf4" id="acf4" class="graf graf--h4 graf-after--p">Why not the JVM?</h4><p name="ae65" id="ae65" class="graf graf--p graf-after--h4">If Docker lets you “run apps build in any language”, why not the JVM? Looking at it from a role-based perspective, the answer is clear: a clash of roles.</p><p name="6586" id="6586" class="graf graf--p graf-after--p">The JVM is designed to be “big”. A platform. It wants to be central, it wants to be long-running and it wants to maximise resource usage. It struggles to play well as a one-of-many ephemeral app.</p><figure name="5753" id="5753" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 499px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 71.3%;"></div><img class="graf-image" data-image-id="1*S-7OdNCQrKq_56s7iZfvSA.jpeg" data-width="3429" data-height="2445" src="https://cdn-images-1.medium.com/max/800/1*S-7OdNCQrKq_56s7iZfvSA.jpeg"></div></figure><p name="baf6" id="baf6" class="graf graf--p graf-after--figure">Add the Spring framework to this mix, which also comes from a platform mindset, then layer on Spring Boot (which tries to wrap the platform in a app-like skin) and you’re really going to move the needle — in an expensive direction.</p><blockquote name="26b9" id="26b9" class="graf graf--pullquote graf-after--p">Every layer of that system is going to cost you, in terms of resource usage and in exponentially increasing complexity.</blockquote><p name="2aa4" id="2aa4" class="graf graf--p graf-after--pullquote">The JVM was designed to support pre-planned app deployment, because apps changed infrequently (echoing a pre-planned capex world) Docker is designed to make continuously shipping, updating, starting, stopping and scaling apps (“<em class="markup--em markup--p-em">containers</em>”) the norm (echoing an on-demand opex world).</p><h4 name="5158" id="5158" class="graf graf--h4 graf-after--p">Lots of microservices</h4><p name="fe24" id="fe24" class="graf graf--p graf-after--h4">Something to be clear about when it comes to microservices is you’ll have lots.</p><p name="b492" id="b492" class="graf graf--p graf-after--p">If you split a single monolithic application into a dozen independent services, then run three copies of each, say across AWS avaliability zones for resilience, you’ll pretty quickly find yourself running dozens, hundreds, or even thousands of microservices.</p><p name="917c" id="917c" class="graf graf--p graf-after--p">If you’re using the JVM to run those microservices you’re going to be running a platform within a platform. If you’re using Spring Boot, each microservice sits in a framework that controls a framework, on top of a platform on top of a platform. Dozens, hundreds, or even thousands of times over.</p><p name="c27c" id="c27c" class="graf graf--p graf-after--p">When you’re consuming cloud computing resources your cost is metered by the megabyte and by the minute. That complexity is going to get very expensive, very quickly.</p><h3 name="0945" id="0945" class="graf graf--h3 graf-after--p">What’s the alternative?</h3><p name="e273" id="e273" class="graf graf--p graf-after--h3">There are good reasons to switch to a programming language designed for a world where the tried and true capex best practice of maximising resource usage is now, in an opex world, a terrible practice for both your budget and your CFO’s blood pressure.</p><p name="6730" id="6730" class="graf graf--p graf-after--p">In this rearranged business operating system you’ll hear words like agility, innovation, responsiveness, user experience and talent attraction. Transformation means expressing this new mindset consistently throughout your organisation — and that includes your technology choices.</p><figure name="4655" id="4655" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 492px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 70.3%;"></div><img class="graf-image" data-image-id="1*NpZIYzdJ8_jcSsK65gLGHw.jpeg" data-width="3424" data-height="2408" src="https://cdn-images-1.medium.com/max/800/1*NpZIYzdJ8_jcSsK65gLGHw.jpeg"></div></figure><p name="b454" id="b454" class="graf graf--p graf-after--figure">The foundations of JVM design were laid and set in a world that strove for once-and-for-all systems: ones that didn’t need to change and (we imagined) could be planned a-priori. In those days, simply using technology was sufficient to win customers. Experience was secondary and we thought we knew ahead of time what our customers and users wanted.</p><p name="b125" id="b125" class="graf graf--p graf-after--p">Modern languages by contrast embody a mindset consistent with the realities of the world we’re in today. Increasingly these soft factors are the hard competitive edge that means sink or swim for a business or, for a public body, the difference between being respected or railed against in the public eye for efficiency and pace or over-spending and slow progress.</p><h4 name="b3a7" id="b3a7" class="graf graf--h4 graf-after--p">Show me the money</h4><p name="86bc" id="86bc" class="graf graf--p graf-after--h4">Love the story, I see it. Nice. Great pictures by the way (thanks!). So… what?</p><p name="a7e0" id="a7e0" class="graf graf--p graf-after--p">I’m glad you asked. <em class="markup--em markup--p-em">Let’s talk about money</em>. We know the more resource-hungry and ponderous your systems are, the more it’ll cost to run them in the cloud. But by how much? 10% or 20%? That would seem like a nice win. It turns out to be way, way more.</p><blockquote name="66b8" id="66b8" class="graf graf--pullquote graf-after--p">We’re potentially looking at 95% savings.</blockquote><p name="cde8" id="cde8" class="graf graf--p graf-after--pullquote">Wow. I ran the numbers and annualised the cost of AWS ec2 instances to run microservices. To give you some context, a mid-sized organisation might land in the middle of the curve and a large organisation to the right:</p><figure name="72ea" id="72ea" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 600px; max-height: 371px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 61.8%;"></div><img class="graf-image" data-image-id="1*1qQV29mpEiNuHXIJiSNOcA.png" data-width="600" data-height="371" src="https://cdn-images-1.medium.com/max/800/1*1qQV29mpEiNuHXIJiSNOcA.png"></div></figure><p name="7833" id="7833" class="graf graf--p graf-after--figure">So there it is in cold hard cash. To drive it home, what this means is that if you switch a Spring Boot application to Python you’d be looking at upwards of 85% savings. Switch it to Go and you’d be over 95%. Add the benefits of agility, iteration, developer experience which translates to talent attraction and it’s a compelling picture.</p><p name="2f62" id="2f62" class="graf graf--p graf-after--p">I know what you’re thinking. You’re right to think it: “Those are wild claims — show me the evidence”. Good. Here’s the working out:</p><p name="034d" id="034d" class="graf graf--p graf-after--p"><a href="https://docs.google.com/spreadsheets/d/1ePAi07k-Ql3uTeemxLC1iLvQLzINO4XbKnc5sUTQjK8/edit#gid=0" data-href="https://docs.google.com/spreadsheets/d/1ePAi07k-Ql3uTeemxLC1iLvQLzINO4XbKnc5sUTQjK8/edit#gid=0" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://docs.google.com/spreadsheets/d/1ePAi07k-Ql3uTeemxLC1iLvQLzINO4XbKnc5sUTQjK8</a></p><p name="a1a2" id="a1a2" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">NB this is based on memory consumption. Assuming a JVM averages 1G, Python 128M and Go 16M. Distributing microservices across 8G AWS ec2 instances (reserving 1G to run the OS and docker) and using the on demand price at time of writing.</em></p><p name="ae35" id="ae35" class="graf graf--p graf-after--p">I’m not the only one to have noticed the scale of the difference. <a href="https://www.aerofs.com/author/huguesb/" data-href="https://www.aerofs.com/author/huguesb/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Hugues Bruant</a> has posted <a href="https://www.aerofs.com/a-little-golang-way-md/" data-href="https://www.aerofs.com/a-little-golang-way-md/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">real-world results</a> from an AeroFS hackathon, <a href="https://twitter.com/marianogappa" data-href="https://twitter.com/marianogappa" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Mariano Gappa</a> has blogged about <a href="https://movio.co/en/blog/saving-money-with-Hackathon-project/" data-href="https://movio.co/en/blog/saving-money-with-Hackathon-project/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">a similar experience</a> and <a href="http://carb.onl/ddd" data-href="http://carb.onl/ddd" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">I’ve giver a talk</a> at <a href="https://www.dddwales.com/" data-href="https://www.dddwales.com/" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">DDD Wales</a> and <a href="https://medium.com/@davidcarboni/simplicity-wins-4fc54efae1f0" data-href="https://medium.com/@davidcarboni/simplicity-wins-4fc54efae1f0" class="markup--anchor markup--p-anchor" target="_blank">blogged about it</a> — resource savings are one to two orders of magnitude (plus a host of technical and sustainability benefits of simpler solutions).</p><h4 name="244a" id="244a" class="graf graf--h4 graf-after--p">Should we abandon the JVM?</h4><p name="2745" id="2745" class="graf graf--p graf-after--h4">The answer is “it depends”. The interesting part of that answer is what “it depends on”.</p><p name="762b" id="762b" class="graf graf--p graf-after--p">I’m an advocate of contextual design. I love principles, patterns and guidelines, however the ultimate arbiter of the “right answer” is the specifics of a context and of the job to be done, at the time. You might have capex infrastructure. You might be building a monolith. You might not be using Docker.</p><p name="f052" id="f052" class="graf graf--p graf-after--p">There are plenty of technical reasons (and personal preferences) that lead people to choose one programming language over another. That’s valid. I’m keen no one dismisses anyone else’s preferences. I’m not being rude about the JVM, <em class="markup--em markup--p-em">it’s just designed for a different context</em>.</p><p name="7489" id="7489" class="graf graf--p graf-after--p">If you’re building more than a few microservices, you’ll want to think hard about whether the JVM is right for you. Basic practicalities like “can a developer run all the services they need on their laptop?” lead to clear and direct costs. Whether that’s expensive developer hardware, or time and effort spent working around the need for resources, it’s going to be expensive.</p><p name="9694" id="9694" class="graf graf--p graf-after--p">Your context may include factors of sufficient size and importance that they nevertheless outweigh the cost of choosing the JVM. The world you operate in is broader than technology. The JVM may be the right choice for you.</p><p name="21d0" id="21d0" class="graf graf--p graf-after--p">If your people know and like the JVM, if your support team doesn’t relish the prospect of being cross-trained (although they might welcome simpler systems to troubleshoot when things go wrong), if you’ve got plenty of cash, or if you have any number of other pressures, including legacy, senior opinions or politics, you may find cost isn’t the most important factor to be considered.</p><p name="9a59" id="9a59" class="graf graf--p graf-after--p">My hope is, if we can be collectively informed and realistic about the scale of this cost, we can make clearer choices. <strong class="markup--strong markup--p-strong">That’s a good thing</strong><em class="markup--em markup--p-em">.</em></p><p name="0c57" id="0c57" class="graf graf--p graf-after--p"><em class="markup--em markup--p-em">I originally posted this as a </em><a href="https://twitter.com/davidcarboni/status/960950805640761344" data-href="https://twitter.com/davidcarboni/status/960950805640761344" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><em class="markup--em markup--p-em">Twitter thread</em></a><em class="markup--em markup--p-em">, but it’s tricky to explain it in a pithy format.</em></p><blockquote name="ba70" id="ba70" class="graf graf--blockquote graf-after--p graf--trailing"><a href="http://openjdk.java.net/projects/jigsaw/" data-href="http://openjdk.java.net/projects/jigsaw/" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank"><em class="markup--em markup--blockquote-em">Java Jigsaw (JPMS)</em></a><em class="markup--em markup--blockquote-em"> could reduce resource usage. Six months on from JDK9 it’s not yet clear whether it will gain adoption. For a long and balanced view, try this post: “</em><a href="https://blog.plan99.net/is-jigsaw-good-or-is-it-wack-ec634d36dd6f" data-href="https://blog.plan99.net/is-jigsaw-good-or-is-it-wack-ec634d36dd6f" class="markup--anchor markup--blockquote-anchor" rel="noopener" target="_blank"><em class="markup--em markup--blockquote-em">Is Jigsaw good or is it wack?</em></a><em class="markup--em markup--blockquote-em">”</em></blockquote></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@davidcarboni" class="p-author h-card">David Carboni</a> on <a href="https://medium.com/p/6c27b4f8ff88"><time class="dt-published" datetime="2018-03-15T08:31:00.922Z">March 15, 2018</time></a>.</p><p><a href="https://medium.com/@davidcarboni/choosing-your-cake-and-eating-it-6c27b4f8ff88" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on May 3, 2019.</p></footer></article></body></html>