<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>The Twelve-Factor Container</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">The Twelve-Factor Container</h1>
</header>
<section data-field="subtitle" class="p-summary">
Can good design be containerised?
</section>
<section data-field="body" class="e-content">
<section name="7776" class="section section--body section--first section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="f329" id="f329" class="graf graf--h3 graf--leading graf--title">The Twelve-Factor Container</h3><h4 name="9121" id="9121" class="graf graf--h4 graf-after--h3 graf--subtitle">Can good design be containerised?</h4><blockquote name="3f04" id="3f04" class="graf graf--blockquote graf-after--h4">Containers hit the tech headlines around 2013 and are now more the rule than the exception. I had the privilege of working with a forward-thinking team in a well known government organisation around that time and by 2015 was running Docker in production.</blockquote><p name="b48c" id="b48c" class="graf graf--p graf-after--blockquote">This project delivered a seismic shift in the ability of the organisation to not only deliver, but deliver at pace. Let’s be clear, containers were only part of that success. The team was the first to be able to work from an <a href="https://medium.com/@davidcarboni/how-to-build-value-with-technology-3fba31443794" data-href="https://medium.com/@davidcarboni/how-to-build-value-with-technology-3fba31443794" class="markup--anchor markup--p-anchor" target="_blank">agile mindset</a>, we prioritised a <a href="https://medium.com/@davidcarboni/activating-high-performing-teams-e1e4b0fea3ac" data-href="https://medium.com/@davidcarboni/activating-high-performing-teams-e1e4b0fea3ac" class="markup--anchor markup--p-anchor" target="_blank">high-performing culture</a> and, crucially, the sponsorship and support of <a href="https://medium.com/@davidcarboni/as-in-life-so-in-tech-98a463b9f7ec" data-href="https://medium.com/@davidcarboni/as-in-life-so-in-tech-98a463b9f7ec" class="markup--anchor markup--p-anchor" target="_blank">transformational leadership</a> made the project possible.</p><figure name="dc4f" id="dc4f" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 467px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 66.7%;"></div><img class="graf-image" data-image-id="0*x_KOlrg5fGL_RSJy" data-width="6000" data-height="4000" data-is-featured="true" src="https://cdn-images-1.medium.com/max/800/0*x_KOlrg5fGL_RSJy"></div><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@samuelzeller?utm_source=medium&amp;utm_medium=referral" data-href="https://unsplash.com/@samuelzeller?utm_source=medium&amp;utm_medium=referral" class="markup--anchor markup--figure-anchor" rel="photo-creator noopener noopener noopener" target="_blank">Samuel Zeller</a> on <a href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" data-href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" class="markup--anchor markup--figure-anchor" rel="photo-source noopener noopener noopener" target="_blank">Unsplash</a></figcaption></figure><p name="7b14" id="7b14" class="graf graf--p graf-after--figure">Within this generative structure of strong culture and leadership, on a practical level, the system used containers and <a href="https://medium.com/@davidcarboni/services-and-microservices-61a3a97233f9" data-href="https://medium.com/@davidcarboni/services-and-microservices-61a3a97233f9" class="markup--anchor markup--p-anchor" target="_blank">microservices</a>, but that wasn’t what made it work.</p><blockquote name="4f96" id="4f96" class="graf graf--pullquote graf-after--p">What really made the difference, day-to-day for pace, progress and results, was a discipline of simplicity in design.</blockquote><p name="3ce2" id="3ce2" class="graf graf--p graf-after--pullquote">Simplicity not just in technology design, but also in how we expressed agile, designing our work environment and iterating our processes to minimise friction and fit the dynamic of the team. From user experience to team culture to architecture, design made it work.</p><h4 name="2d4e" id="2d4e" class="graf graf--h4 graf-after--p">The twelve factor app</h4><p name="74c9" id="74c9" class="graf graf--p graf-after--h4">The twelve factor app is an influential collection of practical design principles which grew out of the experiences of the team at <a href="https://heroku.com" data-href="https://heroku.com" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Heroku</a>. If you work with technology and haven’t come across them, I’d encourage you get to know them: <a href="https://12factor.net/" data-href="https://12factor.net/" class="markup--anchor markup--p-anchor" rel="nofollow noopener" target="_blank">https://12factor.net</a></p><blockquote name="54aa" id="54aa" class="graf graf--pullquote graf-after--p">These principles speak softly and carry big sticks.</blockquote><p name="e420" id="e420" class="graf graf--p graf-after--pullquote">I see in them the kind of hard-won ease that flows from experience and mastery. Along with the <a href="https://www.gov.uk/guidance/government-design-principles" data-href="https://www.gov.uk/guidance/government-design-principles" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Government Design Principles</a>, 12factor is one of my go-to resources, providing a demanding framework in which I can draw out great design.</p><p name="61eb" id="61eb" class="graf graf--p graf-after--p">I’ve found myself returning to the twelve factors with the work of my current team and it’s got me thinking: I don’t suffer out-of-context design lightly, whether from myself or from others. Technical architects expounding me-too aspirations of Google or Netflix scale platforms don’t end well with me.</p><p name="d896" id="d896" class="graf graf--p graf-after--p">So I’m taking my own test. The twelve factors make sense for single-deployable monolithic web applications, but do they still make sense in containers?</p><h4 name="11d0" id="11d0" class="graf graf--h4 graf-after--p">Unboxing the twelve factors</h4><p name="2276" id="2276" class="graf graf--p graf-after--h4">Let’s summarise and contextualise. To quote the introduction:</p><blockquote name="af9c" id="af9c" class="graf graf--blockquote graf-after--p">Our motivation is to raise awareness of some systemic problems we’ve seen in modern application development … and to offer a set of broad conceptual solutions to those problems</blockquote><p name="705f" id="705f" class="graf graf--p graf-after--blockquote">I’ve learnt over the years that when it comes to delivery, it’s important to be specific before generic. Generic is really, really, really hard. Which is why aspirations of reuse are more likely to harm than help a project.</p><blockquote name="e3bc" id="e3bc" class="graf graf--pullquote graf-after--p">I’ve also learnt that more often than not the right answer is not binary.</blockquote><p name="9f2d" id="9f2d" class="graf graf--p graf-after--pullquote">Running through those specific designs and implementations there are, nonetheless, generic patterns. <a href="https://medium.com/@davidcarboni/as-in-life-so-in-tech-98a463b9f7ec" data-href="https://medium.com/@davidcarboni/as-in-life-so-in-tech-98a463b9f7ec" class="markup--anchor markup--p-anchor" target="_blank">Good principles make terrible laws</a>, but held lightly, they provide helpful constraints that might guide you towards a range of good answers.</p><h4 name="3b3e" id="3b3e" class="graf graf--h4 graf-after--p">Specific and generic</h4><p name="f9fa" id="f9fa" class="graf graf--p graf-after--h4">I’m arriving in a place. From here my view is that specific detail is as useless as generic platitude when either ignores or belittles the other. In teams, the unit of delivery is the collective and in design the unit of delivery is “yes, and” — depolarising without losing creative tension. A multidisciplinary team where each person knows they are individually necessary but not sufficient for delivery is when a team works.</p><blockquote name="4cb8" id="4cb8" class="graf graf--pullquote graf-after--p">So I like broad concepts. A lot.</blockquote><p name="5074" id="5074" class="graf graf--p graf-after--pullquote">My favourite Government Design Principle is “<a href="https://www.gov.uk/guidance/government-design-principles#do-less" data-href="https://www.gov.uk/guidance/government-design-principles#do-less" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">Do less</a>”. To me it speaks of the twin traits of humility and confidence. When found together, there’s no need to hide behind a smokescreen of vagueness and clutter. Specific, direct, polite. Clarity is a gift of character. At the same time, “do less” yields no value on its own, until the principled rubber hits the specific road.</p><p name="484e" id="484e" class="graf graf--p graf-after--p">Show me an architecture with one too many boxes in it and I’ll say “How could we do less here? What can we subtract to make this better?” If complexity can’t be justified, it’s <a href="https://medium.com/@davidcarboni/you-say-complex-i-say-complicated-3bf53ffe5f5d" data-href="https://medium.com/@davidcarboni/you-say-complex-i-say-complicated-3bf53ffe5f5d" class="markup--anchor markup--p-anchor" target="_blank">complicatedness</a>. That’s a red flag for delivery, for maintenance and for surviving the rigours of production. It’s unacceptable risk and it needs to go.</p><blockquote name="044b" id="044b" class="graf graf--pullquote graf-after--p">So I like specifics. A lot.</blockquote><p name="4211" id="4211" class="graf graf--p graf-after--pullquote">And I see that these aren’t a contradiction. So lets look at the twelve factors in the specific context of containers.</p><h4 name="68fd" id="68fd" class="graf graf--h4 graf-after--p">The twelve</h4><p name="127a" id="127a" class="graf graf--p graf-after--h4">Let’s take a look at each of the principles and how they sit in a container world:</p><ol class="postList"><li name="f2d5" id="f2d5" class="graf graf--li graf-after--p"><a href="http://One%20codebase,%20tracked%20in%20revision%20control" data-href="http://One codebase, tracked in revision control" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">One codebase, tracked in revision control</strong></a>: to quote, “There is always a one-to-one correlation between the codebase and the app”. In this case an app would correlate to a container, probably a microservice.</li><li name="740d" id="740d" class="graf graf--li graf-after--li"><a href="https://12factor.net/dependencies" data-href="https://12factor.net/dependencies" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Explicitly declare and isolate dependencies</strong></a>: this principle is well supported in a world of containers. “A twelve-factor app never relies on implicit existence of system-wide packages”, which is very much what container isolation gives you. A container really can contain only the files needed to do its work. With a bit of effort and determination <a href="https://github.com/davidcarboni/go-scratch-nonprivileged-multistage/blob/master/README.md" data-href="https://github.com/davidcarboni/go-scratch-nonprivileged-multistage/blob/master/README.md" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">the number of files can be counted on the fingers of one hand</a>.</li><li name="b684" id="b684" class="graf graf--li graf-after--li"><a href="https://12factor.net/config" data-href="https://12factor.net/config" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Store config in the environment</strong></a>: if there’s a sweet spot for how containers constrain your design to improve yours results, this could well be it. Increasingly it feels uncomfortable to do self-harming things. If you’ve come across the term “immutable artifact”, the idea that software should be built once and the resulting “artifact” deployed unchanged in each environment to avoid unpredictable variations, this is it. <em class="markup--em markup--li-em">The container is the unit of immutable deployment and the config values provided by an environment are the wiring that plugs it in to the rest of the system.</em></li><li name="6fdc" id="6fdc" class="graf graf--li graf-after--li"><a href="https://12factor.net/backing-services" data-href="https://12factor.net/backing-services" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Treat backing services as attached resources</strong></a>: when it comes to databases, queues and file storage, containers nudge you further away from storing data and state in the app. In a world where containers can appear and disappear by the bucketload from moment to moment, it becomes really important to externalise data storage. It then becomes ever clearer that delegating the operation of data storage components to your cloud provider makes sense— they’re an externality that’s going to distract from your core value.</li><li name="5b8f" id="5b8f" class="graf graf--li graf-after--li"><a href="https://12factor.net/build-release-run" data-href="https://12factor.net/build-release-run" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Strictly separate build and run stages</strong></a>: this one’s a no-brainer with containers. You build an image, push it to a registry and then pull it to a target machine to run as a container. There are ways to muddy this, but you’ll have to work ever harder to make life difficult for yourself in this respect.</li><li name="085b" id="085b" class="graf graf--li graf-after--li"><a href="https://12factor.net/processes" data-href="https://12factor.net/processes" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Execute the app as one or more stateless processes</strong></a>: here again, containers take 12-factor a step further. They really are only designed to be a single process, isolated inside a dedicated filesystem. You absolutely can insist on finding ways to get around this, but I think you’ll find pretty quickly that your code smells riper than a well-aged blue cheese. Accept the constraint, it’s good for your design.</li><li name="abec" id="abec" class="graf graf--li graf-after--li"><a href="https://12factor.net/port-binding" data-href="https://12factor.net/port-binding" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Export services via port binding</strong></a>: this one may not be obvious at first, so here’s a quote: “The contract with the execution environment is binding to a port to serve requests”. This typically holds true for containerised microservices — all the gubbins needed to respond to requests is included in the container image and the only way to connect to the service is via a port on the container. One particularly neat thing about containers is that each one has a separate address space, so there’s potentially even less effort needed to figure out which port to bind to.</li><li name="ed6e" id="ed6e" class="graf graf--li graf-after--li"><a href="https://12factor.net/concurrency" data-href="https://12factor.net/concurrency" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Scale out via the process model</strong></a>: the 12-factor approach to concurrency and scaling is “horizontal” or “scale out”. Containers are very much designed with this idea in mind. With a stateless design, you should normally be able to run multiple copies of it to provide additional capacity. This principle is a default assumption in Docker Compose, Docker Swarm and Kubernetes.</li><li name="4ff8" id="4ff8" class="graf graf--li graf-after--li"><a href="https://12factor.net/disposability" data-href="https://12factor.net/disposability" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Maximize robustness with fast startup and graceful shutdown</strong></a>: the principle of disposability is a corollary to the ability to scale out. If you can start an additional dozen copies of a microservice, you’ll also want to design for the ability to take instances out of service, whether for reduced capacity or rolling updates. I’ll touch on startup time here as it’s a serious point of friction that I’ve seen ignored in architecture conversations, particularly where there’s a preference for using the JVM, (Java Virtual Machine) especially with the Spring framework. Slow starts (by which I mean anything over one second) destroy both development cycle time and operational agility whilst loading up your cloud hosting bill. In short, expect to pay a lot of money for not a lot of progress. <a href="https://carb.onl/cake" data-href="https://carb.onl/cake" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Don’t shoot the messenger</a>.</li><li name="aca8" id="aca8" class="graf graf--li graf-after--li"><a href="https://12factor.net/dev-prod-parity" data-href="https://12factor.net/dev-prod-parity" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Keep development, staging, and production as similar as possible</strong></a>: this is a big one for containers. Assuming you’re building an image once, in a predictable way, and deploying it to your environments, this is going to help you ensure you’re running exactly the same build in each environment. There’s more to this principle, but I think it’s good to highlight that here again containers are providing a nudge towards 12-factor design.</li><li name="fccb" id="fccb" class="graf graf--li graf-after--li"><a href="https://12factor.net/logs" data-href="https://12factor.net/logs" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Treat logs as event streams</strong></a>: this is one of my favourite container wins. Log rotation was great fun, but ultimately added no real value to applications. I don’t think I’ve seen anyone argue with the practice of writing logs to <em class="markup--em markup--li-em">stdout</em> and allowing them to be routed to the container runtime or off to log storage and analysis — ELK, Prometheus, InfluxDB, Stackdriver — the list is long and varied (and your mileage likewise).</li><li name="181d" id="181d" class="graf graf--li graf-after--li"><a href="https://12factor.net/admin-processes" data-href="https://12factor.net/admin-processes" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--li-strong">Run admin/management tasks as one-off processes</strong></a>: if you’ve ever considered that containers have a lot of similarities to functions (e.g. Lambda, GCP functions) then this principle makes perfect sense. If you’ve come across the intricate solutions that have been touted over the years for database migrations, you may agree that none of them are particularly elegant they generally hang around in your production code like an awkward gooseberry after startup. Putting a one-off task into a one-shot container that starts, does its work and then exits, is a great way to keep things clean.</li></ol><h4 name="2570" id="2570" class="graf graf--h4 graf-after--li">The design nudge</h4><p name="1ae6" id="1ae6" class="graf graf--p graf-after--h4">For me it’s clear that containers are a natural extension of 12-factor thinking. Ultimately, the ability to do anything at any time isn’t helpful, so convergence at a design level, whilst maintaining an open mind on specifics, helps us bring useful lessons into individual situations.</p><blockquote name="db50" id="db50" class="graf graf--blockquote graf-after--p graf--trailing">Design constraints give you nudges and apply pressure to help narrow your options and make you think harder about what good looks like.</blockquote></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@davidcarboni" class="p-author h-card">David Carboni</a> on <a href="https://medium.com/p/8d1edc2a49d4"><time class="dt-published" datetime="2018-08-07T07:31:01.595Z">August 7, 2018</time></a>.</p><p><a href="https://medium.com/@davidcarboni/the-twelve-factor-container-8d1edc2a49d4" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on May 3, 2019.</p></footer></article></body></html>